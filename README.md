# QUOTE SERVICE

REST API-сервис, реализованный на GO, позволяющий производить ряд действий с цитатами, а именно: 
- Добавлять новые цитаты
- Получать список всех цитат
- Получить случайную цитату
- Фильтровать цитаты по автору
- Удалять цитаты по ID

  ## Особенности

- **RESTful API**:
  - Создание, получение и удаление цитат через HTTP-эндпоинты.
  - Фильтрация цитат по автору с помощью query-параметров.
  - Формат запросов и ответов в JSON с обработкой структурированных ошибок.
- **Интеграция с базой данных**:
  - Использует PostgreSQL для постоянного хранения цитат.
  - Миграции для инициализации и обновления схемы базы данных.
- **Структурированное логирование**:
  - Реализовано с использованием `go.uber.org/zap` для детализированного и настраиваемого логирования.
  - Уровни логов: `DEBUG`, `INFO`, `WARN`, `ERROR`.
- **Graceful Shutdown**:
  - Обработка сигналов SIGINT/SIGTERM для завершения текущих запросов и корректного закрытия соединений с базой данных.
- **Конфигурация**:
  - Управляется через файл `config.yaml` для настройки сервера и базы данных локального запуска и `config.docker.yaml` в контейнере.
- **Тестирование**:
  - Модульные тесты для обработчиков и логики репозитория (`handler_test.go`, `storage_test.go`, `quotes_test.go`).
 
## Требования

- **Go**: 1.23
- **Docker** и **Docker Compose**
- **Python 3** (для генерации `docker-compose.yml`)
- **PostgreSQL**: 15 (через Docker или локальную установку)
- **curl** (для тестирования)

## Установка

1. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/your-username/quote-service
   cd quote-service
2. Установите зависимости GO:
   ```bash   
   `go mod tidy`

## API эндпоинты

## Сервис предоставляет следующие эндпоинты под `/quotes`: 
### POST /quotes: Создание новой цитаты.
Тело запроса: `{"author": "Имя автора", "quote": "Текст цитаты"}`

Ответ: `201 Created` с созданной цитатой.

### GET /quotes: Получение всех цитат или фильтрация по автору с помощью `?author=Имя автора`
Ответ: `200 OK``со списком цитат данного автора.

### GET /quotes/random: Получение случайной цитаты.
Ответ: `200 OK` со случайной цитатой.

### DELETE /quotes/{id}: Удаление цитаты по ID.
Ответ: `200 OK` с сообщением об успешной операции.

## Примеры запросов: 

1. Создать цитату:
   ```
   curl -X POST http://localhost:8080/quotes -H "Content-Type: application/json" -d '{"author": "Жданов Дмитрий", "quote": "Brand Scout звучит довольно интересно :)."}'
   ```
2. Получить все цитаты:
  ```
   curl http://localhost:8080/quotes
  ```
3. Получить цитаты по автору:
   ```
   curl http://localhost:8080/quotes?author=Дмитрий Жданов
   ```
4. Получить случайную цитату:
   ```
   curl http://localhost:8080/quotes/random
   ```
5. Удалить цитату:
   ```
   curl -X DELETE http://localhost:8080/quotes/666
   ```

## Архитектура

Проект организован модульно:

- `cmd/quotes/`: Точка входа приложения.
  
- `internal/api/v1/`: Обработчики HTTP-эндпоинтов.
  
- `internal/domain/`: Определения доменных ошибок.

- `internal/models/`: Структуры данных для цитат.

- `internal/repository/postgres/`: Логика хранения в PostgreSQL.

- `internal/service/`: Бизнес-логика операций с цитатами.

- `pkg/http/`: Утилиты для HTTP-сервера.

- `pkg/logger/`: Утилиты для структурированного логирования.

- `pkg/postgres/`: Управление соединением с PostgreSQL.

- `migrations/`: Скрипты миграций базы данных.
